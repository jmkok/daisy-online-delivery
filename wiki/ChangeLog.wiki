#summary List of changes to the specification.

= From the Trial Use Draft to Final Draft =

This is an aggregation of all the changes to the protocol made since the Draft for Trial Use (r566) was released 27 September 2009.

== API ==

Changes to `do-wsdl-10.wsdl`:

  * All `soap:operation`s now have the `soapAction` attribute set to `"/operationName"`.
  * Added note that `returnContent` must never return `false`, only `true` or a fault.
  * Added the `invalidOperation` fault to the signatures of `logOff` and `getContentMetadata`.
  * `keyRing` parameter removed from `getKeyExchangeObject` (moved to ``readingSystemAttributes/config/keyRing`).
  * Calling `getKeyExchangeObject` with unauthorized keys in the `keyRing` results in an `invalidParameter` fault, not `invalidOperation`.
  * Datatype changes:
    * `getContentList/firstItem` changed from `xs:integer` to `xs:int`.
    * `getContentList/id` changed from `xs:ID` to `xs:NMTOKEN`.
    * `getContentList/lastItem` changed from `xs:integer` to `xs:int`.

== Types ==

Changes to `do-types-10.xsd`:

  * Moved `contentMetadata@returnBy` to `resources@returnBy`. This means the Reading System does not need to check getContentMetadata both before and after issuance, and that `@returnBy` is not displayed before issuance. Added note that the attribute may not change while the Content is issued.
  * `label@xml:lang` is now required.  Added optional `label@dir` to indicate direction of text.
  * Added optional `resources@lastModifiedDate`.  Changed the definition of `contentItem@lastModifiedDate` to remove reference to most recent resource.
  * Allowed unlimited `contentMetadata/metadata/narrator`s, not just one.
  * Allowed empty `readingSystemAttributes/config/supportedContentFormats`.
  * `readingSystemAttributes/config/keyRing` added (moved from `getKeyExchangeObject`).
  * `serviceAttributes/supportedUplinkAudioCodecs/codec` now refers to MIME types, not "canonical identifier strings".
  * New `input` type created. `readingSystemAttributes/config/supportedInputTypes/input` and `inputQuestion/inputTypes/input` now both refer to it.  The new `input` type does not have an `xml:lang` attribute.
  * Datatype changes:
    * `announcements/announcements/id` changed from `xs:ID` to `xs:NMTOKEN`.
    * `contentList@firstItem` changed from `xs:integer` to `xs:int`.
    * `contentList@id` changed from `xs:ID` to `xs:NMTOKEN`.
    * `contentList@lastItem` changed from `xs:integer` to `xs:int`.
    * `contentList@totalItems` changed from `xs:integer` to `xs:int`.
    * `contentList/contentItem/id` changed from `xs:ID` to `xs:string`.
    * `contentMetadata/metadata/size` changed from `xs:integer` to `xs:long`.
    * `inputQuestion@id` changed from `xs:ID` to `xs:NMTOKEN`.
    * `label/audio@rangeBegin` changed from `xs:integer` to `xs:long`.
    * `label/audio@rangeEnd` changed from `xs:integer` to `xs:long`.
    * `label/audio@size` changed from `xs:integer` to `xs:long`.
    * `multipleChoiceQuestion@id` changed from `xs:ID` to `xs:NMTOKEN`.
    * `multipleChoiceQuestion/choices/choice@id` changed from `xs:ID` to `xs:NMTOKEN`.
    * `questions/contentListRef` changed from `xs:ID` to `xs:NMTOKEN`.
    * `resource@size` changed from `xs:integer` to `xs:long`.
    * `serviceAttributes/service@id` changed from `xs:string` to `xs:NMTOKEN`.
    * `serviceAttributes/serviceProvider@id` changed from `xs:string` to `xs:NMTOKEN`.

Changes to `bookmark-2005-1.xsd`:  

  * Changed the following types from empty complex types to `xs:string`s:
    * `uid`
    * `timeOffset`
    * `charOffset`
    * `ncxRef`
    * `text`
  * Put the following groups (marked with curly braces `{}`) inside `<xs:sequence>` (does not change the syntax, but allows some XSD parsers to work):
    * `lastmark/{bookmarkContent}`
    * `hilite/hiliteStart/{hiliteContent}`
    * `hilite/hiliteEnd/{hiliteContent}`

== Documentation ==

  * Changed WSDL publishing requirements in Appendix A to have the published WSDL import the provided WSDL, rather than be a modified copy.
  * Added recommendation that menu state be retained for the duration of the session.
  * Added note that says that audio notes are not supported at all.  (Previously it had only mentioned it in setting bookmarks.)
  * Noted that the `keyRing` should only contain names of key pairs, not symmetric keys.

== Primer ==

  * Changed verbiage to indicate that the following attributes are of type xs:NMTOKEN and not xs:ID:
   * inputQuestion/@id  
   * multipleChoiceQuestion/@id
   * multipleChoiceQuestion/choices/choice/@id
  * Modified "dynamicMenusExamples-mainMenu-1.xml":
   * Added @xml:lang to all label elements.
  * Modified "dynamicMenusExamples-purchase-2.xml":
   * Added @xml:lang to all label elements.
  * Modified "dynamicMenusExamples-purchase-4.xml":
   * Added @xml:lang to all label elements.
  * Modified "dynamicMenusExamples-retrieve-4.xml":
   * Added @xml:lang to all label elements.
  * Modified "dynamicMenusExamples-search-3.xml": 
   * Added @xml:lang to all label elements.
  * Modified "dynamicMenusExamples-search-9.xml":
   * Added @xml:lang to all label elements.
  * Modified "dynamicMenusExamples-survey-2.xml":
   * Added @xml:lang to all label elements.
  * Modified "dynamicMenusExamples-survey-4.xml":
   * Added @xml:lang to all label elements.
  * Modified "dynamicMenusExamples-userprofile-2.xml":
   * Added @xml:lang to all label elements.
  * Modified "dynamicMenusExamples-userprofile-5.xml":
   * Added @xml:lang to all label elements.

== Pending ==

  * "expired" `contentList` to be made mandatory.
  * Remove recommendation that `markAnnouncementsAsRead` be called immediately after each announcement is read.