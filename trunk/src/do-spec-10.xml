<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="../util/docbook/rng/docbookxi.rng" type="xml"?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
    xmlns:xi="http://www.w3.org/2001/XInclude" xml:base="." version="5.0">

    <title>Specification for the DAISY Online Delivery Protocol</title>

    <info>
        <releaseinfo>Working Group Draft</releaseinfo>
        <pubdate>28 August 2009</pubdate>
        
        <annotation role="specLinks">
            <para>
                <remark role="todo">TODO: add the correct links</remark>
            </para>
            <para role="specLabel">This version:</para>
            <para role="specLink">
                <link xlink:href="http://www.daisy.org/projects/">http://www.daisy.org/projects/</link>
            </para>
            <para role="specLabel">First Public Draft:</para>
            <para role="specLink">
                <link xlink:href="http://www.daisy.org/projects/">http://www.daisy.org/projects/</link>
            </para>
        </annotation>
        
        <abstract>
            <title>Abstract</title>
            <para>
                    The DAISY Online Delivery Protocol is a web service API that facilitates the discovery and delivery of 
                    content from service providers by end users. Although designed to facilitate the downloading of DAISY content,
                    the API allows any content to be downloaded from a service provider, making it a flexible
                    and lightweight solution to the growing need for online delivery of published content.
            </para>
        </abstract>
        
        <annotation xml:id="status">
            <para>
                <emphasis role="statusDisclaimer">
                    This section describes the status of this document at the time of its publication. 
                    Other documents may supersede this document. A list of current DAISY publications 
                    and the latest revision of this specification can be found in the DAISY projects
                    index at <link xlink:href="http://www.daisy.org/projects/">http://www.daisy.org/projects/</link>.
                </emphasis>
            </para>
            <para>
                This document was developed by the DAISY Online Working Group as a part of its
                activities. For a complete list of members at the time of publication, please refer to
                <xref linkend="acknowledgements"/>.
            </para>
            <para>
                This document is a Working Group Draft. It completely supersedes the first draft
                of the specification that was released on April 15, 2009.
            </para>
            <para>
                This document is considered by the Working Group members to be complete and stable
                for use in creating implementations of the protocol. It is anticipated that some aspects
                of the protocol may change before Recommendation status is given to the document,
                but substantive revisions to the core functionality outlined in this document are not
                anticipated.
            </para>
            <para>
                Please report errors in this document and suggestions for the protocol to the Working Group 
                through the public feedback form available on the DAISY site at 
                <link xlink:href="http://www.daisy.org/support/contactus.php">http://www.daisy.org/support/contactus.php</link>.
                When submitting your feedback, please ensure that the Message Category field has been 
                set to the value "Project: DAISY Online Delivery".
            </para>
            <para>
                The English version of this specification is the only normative version.
            </para>
        </annotation>
        
    </info>
     
    <chapter xml:id="introduction">
        <title>Introduction</title>
        <para>
            <remark role="todo">TODO Introduction remains to the written. It will give an overview
                of target application domains and functionality scope. It will mention that although
                focused on the DAISY DTB content type, the protocol per se is not limited to DAISY.
                It will note that service discovery is not in scope, but that a mechanism for that
                may be produced by DAISY as a separate specification.</remark>
        </para>
        
    </chapter>
    
    <chapter xml:id="terminology">
            <title>Terminology</title>
            
            <para>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
                "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described
                in <xref linkend="bib_RFC2119"/>.</para>
            
            <para>In addition, the following terms are used throughout this document with
                the meanings outlined in this section.</para>
           
                <variablelist>
                 
                    <varlistentry xml:id="term_content">
                        <term>Content</term>
                        <listitem>
                            <para>A resource made available by a <xref linkend="term_serviceProvider"/> through a 
                                <xref linkend="term_service"/>, such as a DAISY Digital Talking Book.</para>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_contentIdentifier">
                        <term>Content Identifier</term>
                        <listitem>
                            <para>The unique identifier assigned to a <xref linkend="term_content"/> item. This identifier is
                                defined by the <xref linkend="term_service"/> and is exposed in the <xref
                                    linkend="bib_dublinCore"/>
                                <literal>identifier</literal> field of the <xref
                                    linkend="tp_contentMetadata"/> type. The identifier must be unique
                                within the scope of the <xref linkend="term_service"/> and it must not change over
                                time.</para>
                            <note>
                                <para>The Content Identifier is not required to match any identifiers used in the <xref linkend="term_content"/> (for example, the unique
                                    identifier for a DAISY Digital Talking Book).</para>
                            </note>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_download">
                        <term>Download</term>
                        <listitem>
                            <para> Transfer of <xref linkend="term_content"/> from the <xref
                                linkend="term_service"/> to the <xref linkend="term_readingSystem"/>,
                                which the <xref linkend="term_readingSystem"/> stores in non-volatile memory. </para>
                            <note>
                                <para>Download and <xref linkend="term_streaming"/> are <xref linkend="term_readingSystem"/> behaviors, not
                                    aspects of this protocol.</para>
                            </note>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_fault">
                        <term>Fault</term>
                        <listitem>
                            <para> A <xref linkend="bib_soap1.1"/> Fault. A fault carries error and/or
                                status information in a SOAP message. <xref linkend="apiReferenceFaults"
                                /> defines the faults used in this protocol. </para>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_interface">
                        <term>Interface</term>
                        <listitem>
                            <para> A <xref linkend="bib_wsdl1.1"/> port type. A set of <xref
                                linkend="term_operation"/>s supported by the <xref
                                    linkend="term_service"/>. </para>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_issue">
                        <term>Issue content</term>
                        <listitem>
                            <para>Grant access to content. A <xref linkend="term_readingSystem"/> uses the <function>
                                <xref linkend="op_issueContent"/>
                            </function> operation to request access from the <xref linkend="term_service"/>. </para>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_operation">
                            <term>Operation</term>
                            <listitem>
                                <para> A <xref linkend="bib_wsdl1.1"/> operation. An action supported by the
                                    <xref linkend="term_service"/>. </para>
                            </listitem>
                        </varlistentry>
                    
                    <varlistentry xml:id="term_readingSystem">
                        <term>Reading System</term>
                        <listitem>
                            <para> A combination of hardware and/or software that accesses a <xref
                                linkend="term_service"/> and renders <xref linkend="term_content"/> to
                                the <xref linkend="term_user"/>. A Reading System may be implemented
                                entirely on one device or it may be split among several.
                                Corresponds to a <xref linkend="bib_wsibasicprofile11_conf"/> consumer.
                            </para>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_return">
                        <term>Return content</term>
                        <listitem>
                            <para>Give up access to <xref linkend="term_content"/>. <xref linkend="term_content"/> is returned when
                                the <xref linkend="term_readingSystem"/> has removed the locally-stored data
                                and called the <function><xref linkend="op_returnContent"/></function> operation 
                                to notify the <xref linkend="term_service"/> to revoke access and remove from 
                                the <xref linkend="term_user"/>'s collection of issued <xref linkend="term_content"/>. This term applies only
                                to loaned or rented <xref linkend="term_content"/>, not free or purchased <xref linkend="term_content"/>.
                            </para>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_service">
                        <term>Service</term>
                        <listitem>
                            <para> 
                                A web service that implements the DAISY Online Delivery Protocol.
                                Corresponds to a <xref linkend="bib_wsibasicprofile11_conf"/> instance.
                            </para>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_serviceDelegate">
                        <term>Service Delegate</term>
                        <listitem>
                            <para> A file hosting server that is not under the control of the <xref
                                linkend="term_serviceProvider"/>. </para>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_serviceProvider">
                        <term>Service Provider</term>
                        <listitem>
                            <para> The person(s) or organization(s) who own a <xref linkend="term_service"/>. </para>
                            <note>
                                <para>The Service Provider may not be the same entity who owns the servers 
                                    the <xref linkend="term_service"/> runs on.</para>
                            </note>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_session">
                        <term>Session</term>
                        <listitem>
                            <para>A sequence of <xref linkend="term_operation"/>s between one <xref
                                linkend="term_readingSystem"/> and one <xref linkend="term_service"/>
                                using an identifier defined by the <xref linkend="term_service"/>. A session
                                may persist across several <link linkend="bib_http11">HTTP</link>
                                connections. Session identifiers may be reused at the <xref linkend="term_service"/>'s discretion.</para>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_streaming">
                        <term>Streaming</term>
                        <listitem>
                            <para> Transfer of <xref linkend="term_content"/> from the <xref
                                linkend="term_service"/> to the <xref linkend="term_readingSystem"/>,
                                which the <xref linkend="term_readingSystem"/> renders immediately and stores only
                                temporarily.</para>
                            <note>
                                <para><xref linkend="term_download"/> and Streaming are <xref linkend="term_readingSystem"/> behaviors, not
                                    aspects of this protocol.</para>
                            </note>
                        </listitem>
                    </varlistentry>
                    
                    <varlistentry xml:id="term_user">
                        <term>User</term>
                        <listitem>
                            <para> A person who interacts with, or accesses <xref linkend="term_content"/>
                                from, a <xref linkend="term_service"/> using a <xref
                                    linkend="term_readingSystem"/>. </para>
                        </listitem>
                    </varlistentry>
                    
                </variablelist>
    
    </chapter>
    
    
    <chapter xml:id="conformance">
        <title>Conformance Definitions</title>
            <section xml:id="conformance_service">
                <title>Service Conformance</title>
                <para>A <xref linkend="term_service"/> is conformant with this specification when: </para>
                <itemizedlist>
                    <listitem>
                        <para>It publishes a <xref linkend="bib_wsdl1.1"/> document, at some URI,
                            whose contents comply with the
                            requirements defined in <xref linkend="appendixWSDL"/></para>
                    </listitem>
                    <listitem>
                        <para>It provides implementations of all required <xref linkend="term_operation"
                        />s of this protocol, as defined in <xref linkend="apiReferenceRequired"
                        /></para>
                    </listitem>
                    <listitem>
                        <para>It complies with the Content Selection Model-specific requirements defined
                            in <xref linkend="fundamentals_contentSelectionModel_reqs_outofband"/>
                            and/or <xref linkend="fundamentals_contentSelectionModel_reqs_browse"
                            /></para>
                    </listitem>
                    <listitem>
                        <para>It supports the protocols defined in <xref
                            linkend="fundamentals_protocols"/></para>
                    </listitem>
                    <listitem>
                        <para>
                            <remark role="todo">TODO other service conformance reqs</remark>
                        </para>
                    </listitem>
                </itemizedlist>
            </section>
            <section xml:id="conformance_readingSystem">
                <title>Reading System Conformance</title>
                <para>A <xref linkend="term_readingSystem"/> is conformant with this specification when: </para>
                <itemizedlist>
                    <listitem>
                        <para>
                            <remark role="todo">TODO RS conformance reqs</remark>
                        </para>
                    </listitem>
                </itemizedlist>
            </section>
     </chapter>


    <chapter xml:id="fundamentals">
        <title>Protocol Fundamentals</title>

        <section xml:id="fundamentals_contentSelectionMethods" conformance="normative"
            xreflabel="Content Selection Methods">
            <title>Content Selection Methods</title>
            <para>The DAISY Online Delivery protocol supports two content selection methods:</para>
            <itemizedlist>
                <listitem xml:id="fundamentals_contentSelectionMethod_outofband"
                    xreflabel="Out-of-band Content Selection Method">
                    <para>an <emphasis>out-of-band</emphasis> method, where the
                        <xref linkend="term_content"/> for the <xref linkend="term_user"/> is 
                        automatically selected or assigned through 
                        an out-of-band mechanism like a web form or content distribution system; and</para>
                </listitem>
                <listitem xml:id="fundamentals_contentSelectionMethod_browse"
                    xreflabel="Browse Content Selection Method">
                    <para>a <emphasis>browsing</emphasis> method, where the <xref linkend="term_user"/>
                        browses the <xref linkend="term_serviceProvider"/>'s collection using 
                        <xref linkend="term_operation"/>s defined by this protocol.</para>
                </listitem>
            </itemizedlist>
            
            <para>A <xref linkend="term_serviceProvider"/> must offer <xref linkend="term_user"/>s at least 
                one content selection method. A <xref linkend="term_service"/> is not required to support both methods.</para>
            
            <para>
                A <xref linkend="term_readingSystem"/> should support both content selection
                models for maximum interopability, but is only required to support
                one model for conformance.
            </para>
            
            <section xml:id="fundamentals_contentSelectionModel_reqs_outofband">
                <title>Out-of-band Content Selection Method Requirements</title>
                <para>A <xref linkend="term_service"/> offering the <xref linkend="fundamentals_contentSelectionMethod_outofband"/> is
                    compliant if it:</para>
                <itemizedlist>
                    <listitem>
                        <para>provides one or more out-of-band mechanisms for the selection/assignment of <xref linkend="term_content"/>;</para>
                    </listitem>
                    <listitem>
                        <para>declares support for the <xref linkend="fundamentals_contentSelectionMethod_outofband"/> in the
                            <code role="type"><xref linkend="tp_supportedContentSelectionModels"/></code> service attribute; and</para>
                    </listitem>
                    <listitem>
                        <para>exposes the selected <xref linkend="term_content"/> to the <xref linkend="term_user"/>s'
                            <xref linkend="term_readingSystem"/>(s) through the <code><xref linkend="op_getContentList"/></code> operation
                            when the operation is invoked with the <parameter>id</parameter> parameter set to the value <literal>new</literal>.</para>
                    </listitem>
                </itemizedlist>
            </section>
            <section xml:id="fundamentals_contentSelectionModel_reqs_browse">
                <title>Browse Content Selection Model Requirements</title>
                <para>A <xref linkend="term_service"/> offering the <xref linkend="fundamentals_contentSelectionMethod_browse"/> is
                    compliant if it:</para>
                <itemizedlist>
                    <listitem>
                        <para>provides support for the <link linkend="overview_dynamic_menus">Dynamic Menus</link> protocol feature; and</para>
                    </listitem>
                    <listitem>
                        <para>declares support for the <xref linkend="fundamentals_contentSelectionMethod_browse"/> in the
                            <code role="type"><xref linkend="tp_supportedContentSelectionModels"/></code> service attribute.</para>
                    </listitem>
                </itemizedlist>
            </section>
        </section>
        
        <section xml:id="fundamentals_protocols" conformance="normative">
            <title>Underlying Protocols</title>

            <section xml:id="fundamentals_protocols_http">
                <title>HTTP</title>
                <para>The DAISY Online Delivery protocol uses <xref linkend="bib_http11"/>:</para>
                <itemizedlist>
                    <listitem>
                        <para>as the transport layer for all SOAP messages sent and received by a <xref linkend="term_service"/>;
                            and</para>
                    </listitem>
                    <listitem>
                        <para>for the transfer of <xref linkend="term_content"/> data.</para>
                    </listitem>
                </itemizedlist>

                <para><xref linkend="term_service"/>s and <xref linkend="term_readingSystem"/>s must support <xref linkend="bib_http11"/> and
                    secure HTTP (HTTPS) through either <xref linkend="bib_ssl3.0"/> or <xref
                        linkend="bib_tls1.0"/>.</para>

                <para>The use of HTTP must conform to <xref linkend="bib_http11"/> and <xref
                        linkend="bib_RFC2617"/>. </para>

                <para><xref linkend="term_service"/>s and <xref linkend="term_readingSystem"/>s must support HTTP sessions as specified in <xref
                linkend="bib_rfc2109"/>.</para>
                
                <note>
                    <para>An established HTTP session is not a valid indicator that a <xref linkend="term_readingSystem"/> has 
                        successfully logged on to the <xref linkend="term_service"/> (see <xref linkend="overview_session"/>).</para>
                </note>

                <para>A <xref linkend="term_service"/> must return the appropriate HTTP status code in the HTTP response (as
                    specified by <xref linkend="bib_http11"/>, Section 10) to all HTTP and HTTPS requests sent by a 
                    <xref linkend="term_readingSystem"/>.</para>

                <section xml:id="fundamentals_protocols_authentication">
                    <title>HTTP Cookies</title>
                    
                    <para>
                        The DAISY Online Delivery protocol requires the use of <xref linkend="bib_httpcookies"/>
                        (as defined in <xref linkend="bib_wsibasicprofile11"/>) to maintain stateful sessions.
                    </para>
                    
                    <para>
                        As per the <xref linkend="bib_wsibasicprofile11"/>, a compliant <xref linkend="term_readingSystem"/>
                        must not process or manipulate the cookies created by a <xref linkend="term_service"/>.
                        The <xref linkend="term_readingSystem"/> must, however, be able to receive and send the cookies
                        that are transmitted to it by a <xref linkend="term_service"/>.
                    </para>
                    
                    <para>
                        A compliant <xref linkend="term_service"/> must be able to manage HTTP Cookies.
                    </para>
                    
                </section>
                
                <section xml:id="fundamentals_protocols_https">
                    <title>HTTPS</title>
                    <para>The use of HTTPS for all transactions with a <xref linkend="term_service"/> is recommended
                        as the data being exchanged may contain confidential information.
                        HTTPS also allows the <xref linkend="term_readingSystem"/> to verify the identity of the 
                        <xref linkend="term_service"/> through the use of certificates.
                    </para>
                    
                    <note>
                        <title>Security consideration</title>
                        <para>
                            It is recommended when implementing HTTPS that all certificates be registered with a 
                            certificate authority and not be self-signed.
                        </para>
                    </note>
                    
                    <para>
                        All URIs that identify resources served over HTTPS must use the 
                        standard URI prefix <literal>https://</literal>.
                    </para>

                    <para>
                        A compliant <xref linkend="term_readingSystem"/> must support HTTPS.
                        Support for HTTPS is recommended for <xref linkend="term_service"/>s.
                    </para>
                </section>

                <section xml:id="fundamentals_protocols_basic_authentication">
                    <title>HTTP Basic Authentication</title>
                    <para>The HTTP Basic Authentication Scheme described in <xref linkend="bib_RFC2617"/>
                        may be used to secure <xref linkend="term_content"/> against unauthorized access.</para>
                    
                    <note>
                        <title>Security consideration</title>
                        <para>
                            It is reommended that Basic Authentication only be used when a secure connection (HTTPS)
                            can be ensured between the <xref linkend="term_readingSystem"/> and <xref linkend="term_service"/>
                            to prevent the exposure of the credentials transmitted in HTTP headers. 
                        </para>
                    </note>
                    
                    <para>
                        When using Basic Authentication, the <xref linkend="term_service"/> must supply the credentials in the
                        server component field of the <xref linkend="term_content"/>'s <abbrev>URI</abbrev>.
                        The scheme for the <literal>userinfo</literal> field as given in
                            <xref linkend="bib_RFC2396"/>, section 3.2.2 is:
                            <replaceable>userinfo</replaceable>@<replaceable>host</replaceable>:<replaceable>port</replaceable>
                    </para>
                    
                    <para>
                        If the credentials also require a password, then the <literal>userinfo</literal> field must be of the form:
                        <replaceable>userid</replaceable>:<emphasis><replaceable>password</replaceable></emphasis>@<replaceable>host</replaceable>:<replaceable>port</replaceable>
                    </para>
                    
                    <note>
                        <title>Security consideration</title>
                        <orderedlist>
                            <listitem>
                                <para>RFC 2396 recommends against the use of the
                                    <replaceable>userid</replaceable>:<replaceable>password</replaceable>
                                    scheme as it may result in the transmission of passwords in the clear and is known
                                    to be a security risk in all cases. A <xref linkend="term_service"/> should only use this
                                    scheme over a secure connection such as HTTPS and <xref linkend="term_readingSystem"/>s
                                    should be developed to avoid the known exploits of this method.
                                </para>
                            </listitem>
                            <listitem>
                                <remark role="todo">
                                    TODO: More needed here?
                                </remark>
                                <para>
                                    The current best practice for the storage of passwords is to only store a cryptographic hash of
                                    each password in case a database is compromised. A <xref linkend="term_service"/>, however,
                                    must be able to retrieve the unencrypted authentication credentials for a <xref linkend="term_user"/> in order to 
                                    supply them in the <literal>userinfo</literal> field. <xref linkend="term_service"/>s 
                                    implementing Basic Authentication using this scheme consequently risk compromising the security of their
                                    databases unless secure retrieval methods are developed.
                                </para>
                            </listitem>
                        </orderedlist>
                    </note>
                    
                    <para>
                        When retrieving <xref linkend="term_content"/>, the <xref linkend="term_readingSystem"/> must only send 
                        Basic Authentication credentials when they are supplied in the <abbrev>URI</abbrev> returned by the
                        <xref linkend="term_service"/>.
                    </para>
                    
                    <para>
                        The credentials required to access <xref linkend="term_content"/> are not required to be the same
                        as the credentials supplied to the <function><xref linkend="op_logOn"/></function> operation.
                    </para>
                    
                    <note>
                        <para>
                            The HTTP Basic Authentication credentials must not be used to log on to the <xref linkend="term_service"/>. For 
                            authenticating a SOAP session, see <xref linkend="fundamentals_protocols_authentication"/>.
                        </para>
                    </note>
                    
                    <para>A compliant <xref linkend="term_readingSystem"/> must support Basic Authentication.
                        <xref linkend="term_service"/> support for Basic Authentication is recommended.</para>
                </section>

                <section xml:id="fundamentals_protocols_http_range">
                    <title>HTTP Range Headers</title>

                    <para>
                        When using HTTP or HTTPS for serving resources, Range Retrieval Requests 
                        (as described in section 14.35 of <link linkend="bib_http11">RFC 2616</link>)
                        must be honored by the <xref linkend="term_service"/>.
                    </para>
                    
                    <para>
                        <xref linkend="term_service"/>s must use correct status codes and Content-Range and Content-Length
                        headers when serving partial content (as described in section 14.16 of <link linkend="bib_http11">RFC 2616</link>). 
                    </para>
                    
                    <para>
                        As it is not possible to require support for range headers on <xref linkend="term_serviceDelegate"/>s, 
                        <xref linkend="term_readingSystem"/>s must be able to handle servers that do not support range headers.
                    </para>
                </section>
            </section>

            <section xml:id="fundamentals_protocols_wsi">
                <title>WS-I Basic Profile</title>

                <para>
                    The DAISY Online Delivery protocol was designed to be compliant with the requirements of 
                    <xref linkend="bib_wsibasicprofile11"/>.
                    All conformant implementations of this protocol must also be compliant
                    with <xref linkend="bib_wsibasicprofile11"/>.
                </para>
                
                <section xml:id="fundamentals_protocols_wsdlbindingstyle">
                    <title>WSDL Binding Style</title>
                    
                    <para>
                        The WSDL binding style used in the abstract WSDL document in 
                        <xref linkend="appendixWSDL"/> is <literal>wrapped document-literal</literal>.
                        The <literal>wrapped document-literal</literal> style is a subset of the 
                        document-literal style and satisfies normative requirement R2712 of 
                        <xref linkend="bib_wsibasicprofile11"/>.
                    </para>
                    
                    <para>
                        Conformant  <xref linkend="term_service"/>s must use the <literal>wrapped document-literal</literal>
                        binding style.
                    </para>
                </section>
            </section>
            
        </section>

    </chapter>

    <chapter xml:id="overview" conformance="normative">
        <title>Protocol Overview</title>

        <section xml:id="overview_serviceModels" conformance="normative"
            xreflabel="Service Models">
            <title>Service Models</title>
            <para>The DAISY Online Delivery Protocol supports two basic service models:</para>
            
            <itemizedlist>
                <listitem xml:id="overview_serviceModel_lender" xreflabel="Lender Model">
                    <para>a <emphasis>lender</emphasis> model, in which <xref linkend="term_content"/> is loaned
                        or rented by a <xref linkend="term_user"/> for a fixed period of time and must be returned 
                        to the <xref linkend="term_serviceProvider"/>; and</para>
                </listitem>
                <listitem xml:id="overview_serviceModel_acquisition" xreflabel="Acquisition Model">
                    <para>an <emphasis>acquisition</emphasis> model, in which the <xref linkend="term_user"/>
                        becomes the owner of the acquired content. This model encompasses both commercial
                        and free-of-charge <xref linkend="term_content"/>.</para>
                    <note>
                        <para>
                            It is possible for a <xref linkend="term_serviceProvider"/> to use the PDTB2 specification
                            to expire acquired <xref linkend="term_content"/> without employing a <xref linkend="overview_serviceModel_lender"/>.
                        </para>
                    </note>
                </listitem>
            </itemizedlist>
            
            <note>
                <para>
                    This specification does not restrict the possible service models to these two definitions. Combinations and variations
                    on the models should be possible using the <xref linkend="term_operation"/>s defined by the protocol. The
                    <xref linkend="term_serviceProvider"/>, however, is solely responsible for ensuring that their model
                    is compatible with the protocol.
                </para>
            </note>
            
            <section xml:id="overview_serviceModels_reqs_lender">
                <title>Basic Lender Model</title>
                <para>A <xref linkend="term_service"/> should meet the following requirements when implementing a basic <xref linkend="overview_serviceModel_lender"/>:</para>
                <itemizedlist>
                    <listitem>
                        <para>
                            It should be capable of managing the collection of <xref linkend="term_content"/> 
                            that has been issued to a <xref linkend="term_user"/>, in particular what 
                            <xref linkend="term_content"/> is still valid and what <xref linkend="term_content"/> has expired.
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            It should respond to the invocation of the <function><xref linkend="op_getContentList"/></function> 
                            operation by providing a <type><xref linkend="tp_contentList"/></type> of issued or expired content 
                            when the operation is called with an <parameter>id</parameter> parameter of <literal>issued</literal> 
                            or <literal>expired</literal>.
                        </para>
                        <note>
                            <para>
                                All <xref linkend="term_content"/> that must be returned must remain present
                                in the <literal>issued</literal> list until it is returned and removed the from collection
                                list by calling the <function><xref linkend="op_returnContent"/></function> operation.
                            </para>
                        </note>
                    </listitem>
                    <listitem>
                        <para>It should implement the <function><xref linkend="op_returnContent"/></function>
                            operation to allow <xref linkend="term_user"/>s to return their issued <xref linkend="term_content"/>.</para>
                    </listitem>
                    <listitem>
                        <remark role="todo">
                            TODO: no attribute specified an not clear what reference is to
                        </remark>
                        
                        <para>It should set the the ??? attribute in the <type><xref linkend="tp_contentMetadata"/></type>
                            of the issued content  to <literal>true</literal>.</para>
                    </listitem>
                </itemizedlist>
            </section>
            
            <section xml:id="overview_serviceModels_reqs_acquisition">
                <title>Basic Acquisition Model</title>
                <para>
                    There is only one requirement for a <xref linkend="term_service"/> to implement a basic 
                    <xref linkend="overview_serviceModel_acquisition"/>: it should respond to calls to the 
                    <function><xref linkend="op_getContentList"/></function> operation by providing an empty 
                    <type><xref linkend="tp_contentList"/></type>.
                </para>
                <note>
                    <para>
                        More complex acquisition models may require the management of issued <xref linkend="term_content"/>
                        to allow repeat downloads or resumption of failed downloads.
                    </para>
                </note>
            </section>
        </section>
        
        
        
         <section xml:id="overview_session">
             <title>User Authentication and Session Management</title>
             
             <section xml:id="overview_session_initializationSequence">
                 <title>Session Initialization</title>
                 
                 <para role="definition" xml:id="def_sessionInitializationSequence"
                     xreflabel="Session Initialization Sequence">
                     The following steps must be followed when starting a <xref linkend="term_session"/>
                     to authenticate the <xref linkend="term_readingSystem"/> to the <xref linkend="term_service"/>:
                 </para>
                 
                 <orderedlist>
                     <listitem>
                         <para>The <xref linkend="term_readingSystem"/> must pass the <xref linkend="term_user"/>'s log in credentials 
                             to the <xref linkend="term_service"/> by calling the 
                             <function><xref linkend="op_logOn"/></function> operation.</para>
                         <note>
                             <para>
                                 The <xref linkend="term_serviceProvider"/> is responsible for stipulating and supplying 
                                 the <xref linkend="term_user"/> with the credentials required to authenticate a 
                                 <xref linkend="term_readingSystem"/>.
                                 A non-exhaustive list of ways to provide credentials includes: per <xref linkend="term_user"/>, 
                                 per group or class of <xref linkend="term_user"/>, or per <xref linkend="term_readingSystem"/>.
                             </para>
                         </note>
                         <note>
                             <para>
                                 The <function><xref linkend="op_logOn"/></function> operation must be called to establish a session 
                                 even if no credentials are required to access the <xref linkend="term_service"/>. 
                             </para>
                         </note>
                     </listitem>
                     <listitem>
                         <para>
                             The <xref linkend="term_service"/> must verify the provided credentials and, if valid,
                             issue an <xref linkend="bib_httpcookies"/> with a unique identifier for the <xref linkend="term_session"/> and embed 
                             it in the Set-Cookie HTTP response header.
                         </para>
                     </listitem>
                     <listitem>
                         <para>
                             The <xref linkend="term_service"/> must send the cookie to the <xref linkend="term_readingSystem"/>
                             when returning the successful response to the <function><xref linkend="op_logOn"/></function> operation.
                         </para>
                     </listitem>
                 </orderedlist>
                 
                 <para> 
                     After receiving a successful log on response, the <xref linkend="term_readingSystem"/> must 
                     invoke the following operations in the given sequence:
                 </para>
                 
                 <orderedlist>
                     <listitem>
                         <para>
                             The <function><xref linkend="op_getServiceAttributes"/></function> operation must be called to
                             discover necessary information about the <xref linkend="term_service"/>.
                         </para>
                     </listitem>
                     <listitem>
                         <para>
                             The <function><xref linkend="op_setReadingSystemAttributes"/></function> operation must be called
                             to provide information about the <xref linkend="term_readingSystem"/>'s capabilities 
                             to the <xref linkend="term_service"/>. The <xref linkend="term_service"/> must respond to this operation
                             call with a return value of <constant>true</constant> (<xref linkend="bib_xsdDatatypes"/>).
                         </para>
                     </listitem>
                 </orderedlist>
                 
                 <para>
                     If a <xref linkend="term_service"/> returns a <link linkend="apiReferenceFaults">Fault</link> during
                     any of the initialization steps, or if a required return value is not provided, the <xref linkend="term_readingSystem"/>
                     must attempt to re-initialize the <xref linkend="term_session"/> or abort the log on process.
                 </para>
                 
                 <note>
                     <para>
                         This protocol does not define what <xref linkend="term_readingSystem"/> behaviors must occur after a
                         log on attempt fails. The <xref linkend="term_readingSystem"/> can alert the user, attempt to reconnect
                         automatically or take whatever action is particular to that device.
                     </para>
                 </note>
                 
                 <para>
                     A <xref linkend="term_service"/> must return an <errorname><xref linkend="ft_invalidOperationFault"/></errorname> 
                     if a <xref linkend="term_readingSystem"/> does not properly execute the initialization sequence outlined in this section.
                 </para>
                 
                 <para>
                     After completing a successful log on and initialization sequence, a 
                     <xref linkend="term_readingSystem"/> can invoke any operations defined by this specification.
                 </para>
                              
             </section>
             
             <section xml:id="overview_session_duration">
                <title>Session Duration</title>
                <para role="definiton" xml:id="def_sessionDuration">
                    A <xref linkend="term_session"/> begins after a successful <function><xref linkend="op_logOn"/></function> 
                    operation. The <xref linkend="term_session"/> must remain active until the <xref linkend="term_readingSystem"/> 
                    sucessfully invokes the <function><xref linkend="op_logOff"/></function> operation or the 
                    <xref linkend="term_service"/> terminates it.
                </para>
                 
                 <note>
                     <para>
                         This protocol does not define behaviors relating to the termination of <xref linkend="term_session"/>s.
                         Time out intervals, reasons for forced termination and related aspects are 
                         defined by the implementation.
                     </para>
                 </note>
                 
                 <para>
                     A <xref linkend="term_service"/> should persist a <xref linkend="term_session"/> across multiple 
                     HTTP connections by a <xref linkend="term_readingSystem"/> so long as the 
                     <xref linkend="term_session"/> is still valid.
                 </para>

            </section>

        </section>

        <section xml:id="overview_content_selection">
            <title>Content Selection</title>
            <para>Depending on the <link linkend="fundamentals_contentSelectionMethods">content
                    selection model</link> employed, Content selection (e.g. the mechanism with
                which the user selects one or several content items to request issuance and transfer
                of) is performed using two distinct approaches:</para>

            <section xml:id="overview_content_selection_outofband">
                <title>Content Selection using the Out-of-band model</title>

                <para>In the <link linkend="fundamentals_contentSelectionMethod_outofband"
                        >Out-of-band model</link> content selection form, content is selected using
                    a mechanism not defined by this specification, and not involving the Session itself.
                    Through this mechanism, the <xref linkend="term_service"/>, typically prior to the Session onset, has
                    in its possession a list of Content items to offer to the User. </para>

                <para>To initiate retrieval of these Content items, the <xref linkend="term_readingSystem"/> invokes the
                        <xref linkend="op_getContentList"/> operation, passing the value
                        <literal>new</literal> as the value of the <parameter>id</parameter> parameter,
                    retrieving a <xref linkend="tp_contentList"/> in return.</para>

            </section>
            
            
            <section xml:id="overview_content_selection_browse">
                <title>Content Selection using the Browse model</title>
                <para>In the <link linkend="fundamentals_contentSelectionMethod_browse">Browse
                        model</link> content selection model, content is selected dynamically within
                    the Session using the <link linkend="overview_dynamic_menus">Dynamic
                        Menu</link> feature of this protocol. Refer to <xref
                        linkend="appendixDynamicMenuExamples_search"/> and <xref
                        linkend="appendixDynamicMenuExamples_retrieve"/> for examples of Content
                    selection using the Dynamic Menu feature.</para>

                <note>
                    <para>A <xref linkend="term_service"/> declares whether it supports Content selection using the Browse
                        model in the <xref linkend="tp_supportedContentSelectionModels"/> element in
                        the <xref linkend="tp_serviceAttributes"/> type returned by the <xref
                            linkend="op_getServiceAttributes"/> operation. <xref linkend="term_service"/>s may support the
                        Dynamic Menu feature for other purposes than supporting content selection,
                        so the value <code>DYNAMIC_MENUS</code> in <xref
                            linkend="tp_supportedOptionalOperations"/> alone does not imply that
                        Content Selection using the Browse model is supported.</para>
                </note>
            </section>
        </section>

        <section xml:id="overview_content_issuing">
            <title>Issuing and transfer of content</title>
            <para>Given a <xref linkend="tp_contentList"/>, retrieved using one of the methods
                described in <xref linkend="overview_content_selection"/>, the <xref linkend="term_readingSystem"/> can
                proceed to request issuance of selected content items within the
                    <type>contentList</type>, followed by download or streaming of the resources
                that constitute the content. </para>

            <section xml:id="overview_content_issuing_retrieval_sequence">
                <title>Content Retrieval Sequence</title>
                <para xml:id="def_contentRetrievalSequence" xreflabel="Content Retrieval Sequence">
                    To request issuance of and retrieve the resources of a Content item, a Reading
                    System must invoke the following operations in the given sequence. Note that all
                    involved operations take the <xref linkend="term_contentIdentifier"/> as a
                    parameter.</para>
                <orderedlist>
                    <listitem>
                        <para>The <function>
                                <xref linkend="op_getContentMetadata"/>
                            </function> operation</para>
                    </listitem>

                    <listitem>
                        <para>The <function>
                                <xref linkend="op_issueContent"/>
                            </function> operation, with a return value of <constant>true</constant>
                                (<xref linkend="bib_xsdDatatypes"/>) </para>
                    </listitem>
                    <listitem>
                        <para>[any other operation]</para>
                    </listitem>
                    <listitem>
                        <para> The <function>
                                <xref linkend="op_getContentResources"/>
                            </function> operation</para>
                    </listitem>
                </orderedlist>

                <para>The <xref linkend="op_getContentMetadata"/> operation contains publication
                    metadata, information on the Content format, an optional sample, and information
                    on whether the content is being borrowed or not. </para>

                <para>The <xref linkend="op_issueContent"/> operation constitutes the formal User
                    request to get access to the Content. This operation must be invoked prior to
                    the invocation of <xref linkend="op_getContentResources"/>.</para>

                <para>If a <xref linkend="term_service"/> returns <constant>false</constant> (<xref
                        linkend="bib_xsdDatatypes"/>) or throws a <link linkend="apiReferenceFaults"
                        >fault</link> on the <function>
                        <xref linkend="op_issueContent"/>
                    </function> operation, then the Content has not been issued. On invocations of <function>
                        <xref linkend="op_getContentResources"/>
                    </function> for a content item that has not been issued, a <xref linkend="term_service"/> must throw a
                        <xref linkend="ft_invalidParameterFault"/>.</para>

                <para>The <xref linkend="op_getContentResources"/> operation exposes all resources
                    that constitute the content to the <xref linkend="term_readingSystem"/>. <xref linkend="term_serviceProvider"/>s must allow
                    at least one call to <function>getContentResources</function> for each issued
                    Content item. <xref linkend="term_serviceProvider"/>s may allow multiple subsequent
                        <function>getContentResources</function> invocations for the same content,
                    possibly spanning several Sessions.</para>
            </section>


            <section xml:id="overview_content_download">
                <title>Downloading and streaming of content</title>
                <para>Once the <xref linkend="term_readingSystem"/> has retrieved the list of <type>resources</type> for
                    an item of content, it may begin downloading or streaming the resources using
                    the URIs supplied in the <type>resource</type>s attributes.</para>
                <para><xref linkend="term_service"/>s may publish resources with URIs unrelated to the names in a content
                    item's fileset. The <code>localFileName</code> attribute specifies the path
                    (delimited with <literal>/</literal>) of the resource relative to the content's
                    root directory. This can be used by download <xref linkend="term_readingSystem"/>s to name the local
                    files. It can be used by streaming <xref linkend="term_readingSystem"/>s to identify the URI of a
                    resource that is referenced by another resource (such as the link to an audio
                    resource in a SMIL resource in a DAISY DTB).</para>
                <para>The <code>mimeType</code> attribute specifies the <xref linkend="bib_mime"/>
                    type of each resource. <xref linkend="term_readingSystem"/>s may use this information to order the
                    transfer of resources, e.g. a streaming <xref linkend="term_readingSystem"/> may retrieve the
                        <abbrev>OPF</abbrev>, <abbrev>NCX</abbrev> and <abbrev>SMIL</abbrev> files
                    of a DTB all at once to allow for quick navigation.</para>
                <para>A DAISY Online session does not need to be active in order for a Reading
                    System to download or stream Content.</para>
                <para>Resources may be stored on the <xref linkend="term_service"/>'s servers or with Service Delegates,
                    without restriction. Note that Service Delegates may require different
                    credentials for access to resources, or may not require credentials at all. The
                    <xref linkend="term_service"/> must provide this information to <xref linkend="term_readingSystem"/>s.</para>
                <para>Resources from the <xref linkend="term_service"/> or from Service Delegates may be secured with Basic
                    Authentication. The credentials must be specified in the URI of each resource so
                    secured. See <xref linkend="fundamentals_protocols_basic_authentication"
                    />.</para>
            </section>

            <section xml:id="overview_content_installments">
                <title>Publishing updates or installments</title>
                <para><type>contentItems</type> in a <type>contentList</type> have an optional
                    attribute, <code>lastModifiedDate</code>, which indicates that last time the
                    content was modified. <xref linkend="term_readingSystem"/>s may use this to determine if the content
                    has been updated since the last time it was accessed. Similarly,
                        <type>resource</type>s in a <type>resources</type> list have an optional
                    attribute also named <code>lastModifiedDate</code>, which indicates that last
                    time that resource was modified. The content modification time should match the
                    most recent resource modification time. <xref linkend="term_readingSystem"/>s may use this to
                    determine which resources been updated since the last time it was
                    accessed.</para>
                <para>This functionality can be used by the <xref linkend="term_service"/> to, e.g., publish corrections to
                    the content. The <xref linkend="term_service"/> could also publish content in installments by
                    progressively updating the same content item. </para>
            </section>

            <section xml:id="overview_content_issuing_pdtb">
                <title>Rights management</title>
                <para>A <xref linkend="term_service"/> may provide all or parts of its content collection in protected
                    form. This version of this specification allows the <xref linkend="bib_pdtb2"/>
                    format to be used for content protection.</para>
                <para>Neither <xref linkend="term_readingSystem"/>s nor <xref linkend="term_service"/>s are required to support
                        <abbrev>PDTB2</abbrev>. If a <xref linkend="term_readingSystem"/> supports <abbrev>PDTB2</abbrev>,
                    it should send the following in its <type>
                        <xref linkend="tp_readingSystemAttributes"/>
                    </type>:</para>
                <programlisting><xi:include href="./samples/pdtb-readingSystemAttributes.xml" parse="text" encoding="UTF-8"/></programlisting>
                <para>If a <xref linkend="term_readingSystem"/> does not support <abbrev>PDTB2</abbrev>, the <xref linkend="term_service"/>
                    should not provide content in that format. If a <xref linkend="term_service"/> supports
                        <abbrev>PDTB2</abbrev> key exchange via the <function>
                        <xref linkend="op_getKeyExchangeObject"/>
                    </function> operation, it must send the following in response to a valid <function>
                        <xref linkend="op_getServiceAttributes"/>
                    </function> call from the <xref linkend="term_readingSystem"/>:</para>
                <programlisting><xi:include href="./samples/pdtb-serviceAttributes.xml" parse="text" encoding="UTF-8"/></programlisting>
                <para>A <xref linkend="term_service"/> may provide Content encrypted with <abbrev>PDTB2</abbrev> even if it
                    does not support <function>getKeyExchangeObject</function>, if there is a
                    reasonable assumption that Users' <xref linkend="term_readingSystem"/>s have the keys necessary to
                    decrypt the Content. </para>
                <para>If Content is protected using <abbrev>PDTB2</abbrev>, then there will be a
                    metadata item in the <type>
                        <xref linkend="tp_contentMetadata"/>
                    </type> named <literal>pdtb2:specVersion</literal> with a value of
                        <literal>2005-1</literal> and there will be resources with mimeTypes
                    beginning with <literal>application/x-pdtb…</literal>. The <xref linkend="term_readingSystem"/> can
                    access these resources even if it does not support <abbrev>PDTB2</abbrev>, but
                    it might not be able to decrypt all the Content.</para>
                <example>
                    <title>
                        <abbrev>PDTB</abbrev>
                        <type>contentMetadata</type> and <type>resources</type>
                    </title>
                    <para>The following is an example of the <type>contentMetadata</type> and
                            <type>resources</type> for an item encrypted using
                            <abbrev>PDTB2</abbrev>.</para>
                    <programlisting><xi:include href="./samples/pdtb-contentMetadata.xml" parse="text" encoding="UTF-8"/></programlisting>
                    <programlisting><xi:include href="./samples/pdtb-resources.xml" parse="text" encoding="UTF-8"/></programlisting>
                </example>
                <para>If some Content has an Authorization Object (<abbrev>AO</abbrev>), the Reading
                    System can inspect it for the name of the key that secures the key to decrypt
                    the Content.</para>
                <para>The <xref linkend="term_readingSystem"/> may call <function>
                        <xref linkend="op_getKeyExchangeObject"/>
                    </function> with a list of names of keys on its keyring (these can be all or
                    some of the symmetric keys or public/private keypairs the <xref linkend="term_readingSystem"/>
                    supports) and the name of the requested key. The <xref linkend="term_service"/> is free to choose any
                    of the keys in the <parameter>keyRing</parameter> to encrypt the Key Exchange
                    Object (<abbrev>KXO</abbrev>). If the <xref linkend="term_service"/> does not have any of those keys or
                    if the User is not authorized to access the Content, then the <xref linkend="term_service"/> will
                    instead reply with an <errorname>
                        <xref linkend="ft_invalidOperationFault"/>
                    </errorname>. The <xref linkend="term_service"/> is responsible for keeping a list of authorized key
                    names.</para>
                <example>
                    <title>An Encrypted DTB</title>
                    <para>A User wants to read an encrypted <abbrev>PDTB</abbrev> from the Zenith
                        Library. The <abbrev>AO</abbrev> is itself encrypted with a key named
                            <literal>DAISY.gy-zlog.afc26219-auth</literal>:</para>
                    <programlisting><xi:include href="./samples/authorization.xml" parse="text"/></programlisting>
                    <para>The User has keys for the <xref linkend="term_readingSystem"/> (an Acme Reader Express) as well
                        as user account keys supplied by Haute-Bibliothèque and Apex Talking Books,
                        Inc. The <xref linkend="term_readingSystem"/> calls the <function>
                            <xref linkend="op_getKeyExchangeObject"/>
                        </function> operation with the first parameter,
                            <parameter>keyRing</parameter>, as:</para>
                    <programlisting><xi:include href="./samples/pdtb-keyRing.xml" parse="text"/></programlisting>
                    <para>and the second parameter,<parameter>requestedKeyName</parameter>, as
                            <literal>DAISY.gy-zlog.afc26219-auth</literal>.</para>
                    <para>The <xref linkend="term_service"/> determines that the User is authorized to receive this key.
                        The <xref linkend="term_serviceProvider"/> has determined that the Acme Reader Express is a
                        trusted <xref linkend="term_readingSystem"/> model, so the <xref linkend="term_service"/> returns a <abbrev>KXO</abbrev>
                        encrypted with the model key,
                        <literal>DAISY.lv-acme.ReaderExpress</literal>:</para>
                    <programlisting><xi:include href="./samples/kxo.xml" parse="text"/></programlisting>
                </example>
                <example>
                    <title>Rights Management without Encryption</title>
                    <para>Note that <abbrev>PDTB2</abbrev> can be used for rights expression without
                        encryption. The following <abbrev>AO</abbrev> describes the permission to
                        play the audio of a certain book which expires at midnight on 31 October
                        2010, but has no encrypted parts.</para>
                    <programlisting><xi:include href="./samples/authorization-unencrypted.xml" parse="text"/></programlisting>
                    <para>A <abbrev>PDTB2</abbrev>-compliant <xref linkend="term_readingSystem"/> will prevent the user
                        from playing the audio after that time, even though it is not encrypted. A
                        non-compliant <xref linkend="term_readingSystem"/>'s behavior is, naturally, undefined.</para>
                </example>
            </section>
        </section>
        <section xml:id="overview_content_return">
            <title>Content Return</title>
            <para>Content return is employed in the case where a Reading System has content issued
                from a Service that employs a library or rental model, and where the given Content item issued from that
                Service is explicitly of a borrowed nature (as defined by the value of the
                    <code>requiresReturn</code> attribute on <xref linkend="tp_contentMetadata"
                />).</para>
            <para>A service using a library or rental model will need to
                manage the User's Content collection in terms of what Content is issued,
                and what Content has expired. By invoking <xref linkend="op_getContentList"/> with
                the <parameter>id</parameter> parameter valued <code>expired</code>, a Reading
                System will retrieve a list of the Content items that has expired, if any. For each
                of the Content items in this list it must then delete the Content from its local
                storage media, followed by an invocation of <xref linkend="op_returnContent"
                />. <remark role="todo">TODO: when must this happen? what if the reading system
				doesn't have the content? what about streaming? add bit regarding discouraged
				use of expired.</remark></para>

        </section>


        <section xml:id="overview_service_announcements">
            <title>Service Announcements</title>
            <para><remark role="todo">TODO fix this introduction</remark> Service Announcements are
                used as a means for the <xref linkend="term_service"/> to provide various types of information to the User.
                Examples include: information on <xref linkend="term_service"/> up- or downtime, information on additions
                to the Content collection, and information on due or overdue Content.</para>
            <para>Note that <xref linkend="op_getServiceAnnouncements"/> is an optional operation -
                <xref linkend="term_service"/>s may or may not support this protocol feature.</para>

            <para>Service Announcements are typically retrieved at the onset of each <xref
                    linkend="term_session"/>, but may be retrieved at any stage of a Session, as
                long as the <xref linkend="def_sessionInitializationSequence"/> has been
                successfully completed.</para>

            <para>If a <xref linkend="term_service"/> <link linkend="op_getServiceAttributes">supports this optional
                    operation</link>, then <xref linkend="term_readingSystem"/>s should invoke the operation at least once
                per Session. If a <xref linkend="term_service"/> does not support this operation, then invocations of it
                must result in an <xref linkend="ft_operationNotSupportedFault"/>.</para>

            <para>A <xref linkend="term_readingSystem"/> should invoke the <function>
                    <xref linkend="op_markAnnouncementsAsRead"/>
                </function> operation to signal to the <xref linkend="term_service"/> which of the provided announcements
                have been consumed by the User. Consistent use of <function>
                    <xref linkend="op_markAnnouncementsAsRead"/>
                </function> enables the <xref linkend="term_service"/> to avoid exposing the User to the same announcement
                multiple times. Note that a <xref linkend="term_service"/> may also on its own accord remove individual
                announcements from the set of distributed announcements, as the embedded messages
                become outdated or otherwise obsolete.</para>

            <note>
                <para>The identifier values of individual <xref linkend="tp_announcement"/>s in the
                        <xref linkend="tp_announcements"/> type are only valid for the duration of
                    the current Session. A <xref linkend="term_readingSystem"/> must only invoke <function>
                        <xref linkend="op_markAnnouncementsAsRead"/>
                    </function> using parameter values supplied via a previous invocation of <function>
                        <xref linkend="op_getServiceAnnouncements"/>
                    </function>, made during the same Session. </para>
            </note>

        </section>

        <section xml:id="overview_bookmarks">
            <title>Bookmarks and Last Reading Position</title>

            <para>If a <xref linkend="term_service"/> supports the <link linkend="op_getServiceAttributes">optional
                    operations</link>
                <function>
                    <xref linkend="op_setBookmarks"/>
                </function> and <function>
                    <xref linkend="op_getBookmarks"/>
                </function>, then a <xref linkend="term_readingSystem"/> may invoke these operations to store and/or
                retrieve a set of bookmarks for a given Content item. Note that the grammar used
                also includes a dedicated <code>lastMark</code> element which is used to persist the
                location where the User most recently ceased reading.</para>

            <para>The <type>
                    <xref linkend="tp_bookmarkSet"/>
                </type> type is a direct derivation of the <token>Portable Bookmarks and
                    Highlights</token> grammar of <xref linkend="bib_z3986-2005"/>. <xref
                    linkend="bib_z3986-2005-bkmk"/> constitutes the normative reference regarding
                the use and semantics of this type.</para>

            <!--<section xml:id="overview_bookmarks_otherContent" conformance="informative">
                <title>Using the Portable Bookmarks and Highlights grammar for content other than
                    ANSI/NISO Z39.86</title> -->
            <note>
                <para><xref linkend="bib_z3986-2005-bkmk"/> was developed exclusively to support
                    bookmarks and highlights for <xref linkend="bib_z3986-2005"/> and its
                    predecessor. Until <xref linkend="bib_z3986-2005-bkmk"/> is revised to be more
                    agnostic in terms of what content types it supports, there is a possibility that
                    <xref linkend="term_readingSystem"/>s may attempt to make use of this grammar in content contexts
                    other than Z39.86. To use this grammar in the context of <xref
                        linkend="bib_d202"/> content for example, all that is needed is to consider
                    the <code>ncxRef</code> value valid even if it's URI points to a fragment in a
                    DAISY 2.02 NCC document instead of a Z39.86 NCX document. </para>

                <para>This specification does not endorse this behavior, but merely suggests that
                    <xref linkend="term_service"/>s should be designed with the awareness that a <xref linkend="term_readingSystem"/> may post a
                        <xref linkend="tp_bookmarkSet"/> type even if the given Content type is not
                    ANSI/NISO Z39.86.</para>
            </note>
            <!--</section>-->
            <note>
                <para><xref linkend="bib_z3986-2005-bkmk"/> allows User audio recordings in notes.
                    This version of this specification does not allow such recordings to be
                    submitted to the <xref linkend="term_service"/> as part of the <xref linkend="op_setBookmarks"/>
                    operation.</para>
            </note>

        </section>
 
        <section xml:id="overview_dynamic_menus" conformance="informative">
            <title>Dynamic Menus</title>
            
            <para>The Dynamic Menu feature of this protocol enables a <xref linkend="term_service"/>
                to offer a menu system to a <xref linkend="term_readingSystem"/> that is entirely
                defined by the <xref linkend="term_service"/>, and that does not require any explicit semantic
                understanding on the part of a <xref linkend="term_readingSystem"/> for rendering to the <xref
                    linkend="term_user"/>. This offers a <xref linkend="term_service"/> the flexibility to define a menu
                system that meets its requirements, and modify such a menu system at any stage
                without requiring any change on the <xref linkend="term_readingSystem"/>.</para>
            
            <para>As described in <xref linkend="fundamentals_contentSelectionMethods"/>, a <xref linkend="term_service"/>
                that supports the <xref linkend="fundamentals_contentSelectionMethod_browse"/> must
                also support the Dynamic Menu feature in order to allow the user to select Content
                to request issuance and transfer of. <xref linkend="term_service"/>s that only provide the <xref
                    linkend="fundamentals_contentSelectionMethod_outofband"/> do not need to support
                Dynamic Menus. Note however (and as exemplified in <xref
                    linkend="appendixDynamicMenuExamples"/>) that it is perfectly possible to use
                Dynamic Menus for other purposes than content selection.</para>
            
            <para><xref linkend="term_service"/>s declare whether they support Dynamic Menus in the <xref
                linkend="tp_supportedOptionalOperations"/> field of <xref
                    linkend="tp_serviceAttributes"/>.</para>
            
            <para>This section describes the fundamental concepts underlying the design of the
                Dynamic Menu feature. For implementation examples of how to employ this feature,
                refer to <xref linkend="appendixDynamicMenuExamples"/>.</para>
            
            <section xml:id="overview_dynamic_menus_concepts">
                <title>Fundamental Concepts of the Dynamic Menu Feature</title>
                
                <section xml:id="overview_dynamic_menus_concept1">
                    <title>A Menu System is a series of interconnected questions</title>
                    
                    <para>The Dynamic Menu feature requires the implementation of the single
                        operation <function>
                            <xref linkend="op_getQuestions"/>
                        </function>. The <function>getQuestions</function> operation is invoked when
                        a <xref linkend="term_readingSystem"/> wants to initiate a Dynamic Menu operation sequence, as
                        well as when it wants to retrieve the next question (aka menu item) in the
                        operation sequence. </para>
                    
                    <para>There are two kinds of questions: </para>
                    
                    <itemizedlist>
                        <listitem>
                            <para>Multiple choice questions are questions that include a predefined
                                set of choices that a user is required to pick from in order to
                                answer the question. A Multiple choice question is represented by
                                the <xref linkend="tp_multipleChoiceQuestion"/> element, which
                                appears inside the <xref linkend="tp_questions"/> element.</para>
                        </listitem>
                        <listitem>
                            <para>Input questions are questions that do not offer such a predefined
                                set of choices, but require the user to respond to the question
                                through either numeric, alphanumeric or audio input. An input
                                question is represented by the <xref linkend="tp_inputQuestion"/>
                                element which appears inside the <xref linkend="tp_questions"/>
                                element.</para>
                            
                            <para>A <xref linkend="term_service"/> can specify whether a given input question requires a
                                numeric, alphanumeric or audio-based response from the User.
                                Combined modalities are also allowed. The required response modality
                                for an input question is specified in the <xref
                                    linkend="tp_inputTypes"/> element which appears inside the <xref
                                        linkend="tp_inputQuestion"/> element.</para>
                            <para>A <xref linkend="term_readingSystem"/> declares which input types it supports in <xref
                                linkend="tp_readingSystemAttributes"/>, which means that the
                                <xref linkend="term_service"/> can adapt to possible <xref linkend="term_readingSystem"/> constraints in this
                                regard. </para>
                        </listitem>
                    </itemizedlist>
                    
                    <para>The <xref linkend="op_getQuestions"/> operation returns a <xref
                        linkend="tp_questions"/> type, that may contain: <itemizedlist>
                            <listitem>
                                <para>One or more multiple choice questions or input questions
                                    through the <xref linkend="tp_multipleChoiceQuestion"/> and
                                    <xref linkend="tp_inputQuestion"/> child elements. </para>
                            </listitem>
                            <listitem>
                                <para>A <xref linkend="tp_label"/> child element. </para>
                            </listitem>
                            <listitem>
                                <para>The ID of a <xref linkend="tp_contentList"/> type through the
                                    <xref linkend="tp_contentListRef"/> child element. </para>
                            </listitem>
                        </itemizedlist>
                    </para>
                    
                    <para>Although the questions type conceptually corresponds to a container for
                        one or more questions (multiple choice question(s) or input question(s)), it
                        can also contain a <xref linkend="tp_label"/> child element or a <xref
                            linkend="tp_contentListRef"/> child element. The occurrence of
                        <type>label</type> or <type>contentListRef</type> corresponds to the
                        case where a Dynamic Menu operation sequence has reached its "logical end",
                        e.g. when the <xref linkend="term_service"/> presents a final result to the User. In the
                        <type>label</type> case, the result is an informative statement ("Thank
                        you for borrowing this book!"), and in the <type>contentListRef</type> case
                        it is a reference to a list of Content items that have been made available
                        as a result of the Dynamic Menu operation sequence. Refer to <xref
                            linkend="appendixDynamicMenuExamples_profileUpdate"/> for concrete
                        examples on "logical ends".</para>
                </section>
                <section xml:id="overview_dynamic_menus_concept2">
                    <title>A Menu System has a root question</title>
                    
                    <para>A Menu System has a root question - the first question in the series of
                        interconnected questions, conceptually corresponding to the "main
                        menu".</para>
                    
                    <para>A <xref linkend="term_readingSystem"/> Retrieves the root question (aka main menu) of a <xref linkend="term_service"/>
                        by invoking the <function>getQuestions</function> operation and passing in
                        the reserved id <literal>default</literal>. Refer to <xref
                            linkend="appendixDynamicMenuExamples_mainMenu"/> for a concrete
                        example.</para>
                    
                    <note>
                        <para>There are two additional reserved IDs used on the context of
                            <function>getQuestion</function>: <literal>search</literal> and
                            <literal>back</literal>, whose use is defined in <xref
                                linkend="tp_userResponse"/>.</para>
                    </note>
                </section>
                <section xml:id="overview_dynamic_menus_concept3">
                    <title>The response determines the next question</title>
                    
                    <para>In a menu system, a User's response to a question determines what question
                        will be presented to the user next. The Dynamic Menu feature of this
                        protocol has been designed to be as efficient as possible in terms of the
                        number of operation invocations required, therefore the <xref
                            linkend="op_getQuestions"/> operation takes as a parameter the User's
                        response to the <emphasis>previous</emphasis> question.</para>
                    
                    <para>The <xref linkend="op_getQuestions"/> operation takes one parameter. The
                        data type of this parameter is <type>
                            <xref linkend="tp_userResponses"/>
                        </type>.</para>
                    
                    <para>The <type>userResponses</type> type has been designed to carry the
                        response(s) of a user to a question(s). The response can either be a
                        choice(s) that the user picked for a <xref
                            linkend="tp_multipleChoiceQuestion"/>, or a numeric, alphanumeric or
                        audio-based response to an <xref linkend="tp_inputQuestion"/>. The
                        <type>userResponses</type> type can have one or more <type>
                            <xref linkend="tp_userResponse"/>
                        </type> child elements. Each <type>userResponse</type> child element
                        contains the user's response to a particular question.</para>
                </section>
            </section>
        </section>
        
        <!--
        <section xml:id="overview_diagnostics">
            <title>Diagnostics and Error Handling</title>
            <para><remark role="todo"></remark></para>
        </section>
        <section xml:id="overview_complete_session_examples">
            <title>Complete session examples</title>
            <para>
                <remark role="todo">May be overkill, add last or remove.</remark>
            </para>
        </section>
        -->

    </chapter>

    <chapter xml:id="apiReference" conformance="normative">
        <title>API Definition</title>
        <para>Don't edit this chapter here in the docbook source - autogenerated from WSDL</para>
    </chapter>

    <chapter xml:id="typeReference" conformance="normative">
        <title>Type Definition</title>
        <para>Don't edit this chapter here in the docbook source - autogenerated from XSD</para>
    </chapter>

    <bibliography conformance="normative">
        <title>References</title>
        <biblioentry xml:id="bib_d202">
            <abbrev>DAISY 2.02</abbrev>
            <title>
                <link xlink:href="http://www.daisy.org/z3986/specifications/daisy_202.html">DAISY
                    2.02 Specification</link>
            </title>
            <author>
                <personname>M Gylling, et al</personname>
            </author>
            <date>February 2001</date>
        </biblioentry>

        <biblioentry xml:id="bib_dublinCore">
            <abbrev>Dublin Core</abbrev>
            <title>
                <link xlink:href="http://dublincore.org/documents/2008/01/14/dces/">Dublin Core
                    Metadata Element Set, Version 1.1</link>
            </title>
            <date>January 2008</date>
        </biblioentry>
        <biblioentry xml:id="bib_infoset">
            <abbrev>INFOSET</abbrev>
            <title>
                <link xlink:href="http://www.w3.org/TR/xml-infoset/">XML Information Set (Second
                    Edition)</link>
            </title>
            <author>
                <personname>J Cowan, R Tobin</personname>
            </author>
            <date>February 2004</date>
        </biblioentry>
        <biblioentry xml:id="bib_iso3166">
            <abbrev>ISO 3166</abbrev>
            <title>
                <link
                    xlink:href="http://www.iso.org/iso/en/prods-services/iso3166ma/02iso-3166-code-lists/list-en1.html"
                    >ISO 3166-1 - Codes for the representation of names of countries and their
                    subdivisions - Part 1: Country codes</link>
            </title>
        </biblioentry>
        <biblioentry xml:id="bib_RFC2119">
            <abbrev>RFC 2119</abbrev>
            <title>
                <link xlink:href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to
                    Indicate Requirement Levels, RFC 2119</link>
            </title>
            <date>March 1997</date>
        </biblioentry>
        <biblioentry xml:id="bib_RFC2396">
            <abbrev>RFC 2396</abbrev>
            <title>
                <link xlink:href="http://tools.ietf.org/html/rfc2396">Uniform Resource Identifiers
                    (URI): Generic Syntax, RFC 2396</link>
            </title>
            <date>August 1998</date>
        </biblioentry>
        <!--
        <biblioentry xml:id="bib_RFC2616">
            <abbrev>RFC 2616</abbrev>
            <title>
            <link xlink:href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol - HTTP/1.1
            
            </link>
            </title>
            <date>June 1999</date>
        </biblioentry>
-->
        <biblioentry xml:id="bib_RFC2617">
            <abbrev>RFC 2617</abbrev>
            <title>
                <link xlink:href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and
                    Digest Access Authentication, RFC 2617</link>
            </title>
            <date>June 1999</date>
        </biblioentry>
        <biblioentry xml:id="bib_mime">
            <abbrev>MIME</abbrev>
            <title>
                <link xlink:href="http://tools.ietf.org/html/rfc2046">Multipurpose Internet Mail
                    Extensions (MIME) Part Two: Media Types, RFC 2046</link>
            </title>
            <author>
                <personname>N.Freed, et al</personname>
            </author>
            <date>November 1996</date>
        </biblioentry>
        <biblioentry xml:id="bib_xsdDatatypes">
            <abbrev>XML Schema 2</abbrev>
            <title>
                <link xlink:href="http://www.w3.org/TR/xmlschema-2/">XML Schema Part 2: Datatypes
                    Second Edition</link>
            </title>
            <author>
                <personname>P. V. Biron, et al</personname>
            </author>
            <date>28 October 2004</date>
        </biblioentry>
        <!--
        <biblioentry xml:id="refXML">
            <abbrev>XML</abbrev>
            <title>
                <link xlink:href="http://www.w3.org/TR/2006/REC-xml-20060816/">Extensible Markup
                    Language (XML) 1.0 (Fourth Edition)</link>
            </title>
            <author>
                <personname>T. Bray, et al</personname>
            </author>
            <date>November 2008</date>
        </biblioentry>
        -->
        <biblioentry xml:id="bib_http11">
            <abbrev>HTTP 1.1</abbrev>
            <title>
                <link xlink:href="http://tools.ietf.org/html/rfc2616">HyperText Transfer Protocol
                    1.1, RFC 2616</link>
            </title>
            <date>June 1999</date>
        </biblioentry>

        <biblioentry xml:id="bib_httpcookies">
            <abbrev>HTTP Cookies</abbrev>
            <title>
                <link
                    xlink:href="http://www.ws-i.org/Profiles/BasicProfile-1.1-2004-08-24.html#HTTP_Cookies"
                    >HTTP cookies in WS-I Basic Profile 1.1</link>
            </title>
        </biblioentry>

        <biblioentry xml:id="bib_doc-lit-conformance">
            <abbrev>Document-Literal Conformance</abbrev>
            <title>
                <link
                    xlink:href="http://www.ws-i.org/Profiles/BasicProfile-1.1-2004-08-24.html#Child_Element_for_Document-Literal_Bindings"
                    >Child Element for Document-Literal Bindings</link>
            </title>
        </biblioentry>

        <biblioentry xml:id="bib_mtom">
            <abbrev>MTOM</abbrev>
            <title>
                <link xlink:href="http://www.w3.org/TR/soap12-mtom/">SOAP Message Transmission
                    Optimization Mechanism</link>
            </title>
            <author>
                <personname>M Gudgin, et al</personname>
            </author>
            <date>January 2005</date>
        </biblioentry>

        <biblioentry xml:id="bib_soap1.1">
            <abbrev>SOAP 1.1</abbrev>
            <title>
                <link xlink:href="http://www.w3.org/TR/2000/NOTE-SOAP-20000508/">Simple Object
                    Access Protocol 1.1</link>
            </title>
        </biblioentry>

        <biblioentry xml:id="bib_pdtb2">
            <abbrev>PDTB2</abbrev>
            <title>
                <link xlink:href="http://www.daisy.org/projects/pdtb/daisy-pdtb-spec.html">DAISY
                    Protected Digital Talking Book 2</link>
            </title>
        </biblioentry>

        <biblioentry xml:id="bib_rfc2109">
            <abbrev>RFC 2109</abbrev>
            <title>
                <link xlink:href="http://tools.ietf.org/html/rfc2109">HTTP State Management
                    Mechanism</link>
            </title>
            <author>
                <personname>D. Kristol</personname>
            </author>
            <date>February 1997</date>

        </biblioentry>

        <biblioentry xml:id="bib_ssl3.0">
            <abbrev>SSL 3.0</abbrev>
            <title>
                <link xlink:href="http://tools.ietf.org/html/draft-ietf-tls-ssl-version3">Secure
                    Sockets Layer 3.0</link>
            </title>
        </biblioentry>

        <biblioentry xml:id="bib_tls1.0">
            <abbrev>TLS 1.0</abbrev>
            <title>
                <link xlink:href="http://www.ietf.org/rfc/rfc2246">Transport Layer Security
                    1.0</link>
            </title>
        </biblioentry>

        <biblioentry xml:id="bib_wsibasicprofile11">
            <abbrev>WS-I Basic Profile 1.1</abbrev>
            <title>
                <link xlink:href="http://www.ws-i.org/Profiles/BasicProfile-1.1-2004-08-24.html"
                    >WS-I Basic Profile 1.1</link>
            </title>
        </biblioentry>

        <biblioentry xml:id="bib_wsibasicprofile11_conf">
            <abbrev>WS-I Basic Profile 1.1 Conformance Targets</abbrev>
            <title>
                <link
                    xlink:href="http://www.ws-i.org/Profiles/BasicProfile-1.1.html#conformance_targets"
                    >WS-I Basic Profile 1.1 Conformance Targets</link>
            </title>
        </biblioentry>

        <biblioentry xml:id="bib_wsdl1.1">
            <abbrev>WSDL 1.1</abbrev>
            <title>
                <link xlink:href="http://www.w3.org/TR/2001/NOTE-wsdl-20010315">Web Services
                    Definition Language 1.1</link>
            </title>
        </biblioentry>

        <biblioentry xml:id="bib_z3986-2005">
            <abbrev>Z39-86.2005</abbrev>
            <title>
                <link xlink:href="http://www.daisy.org/z3986/2005/Z3986-2005.html">ANSI/NISO
                    Z39-86.2005 - Specifications for the Digital Talking Book </link>
            </title>
            <author>
                <personname>M. Moodie, et al</personname>
            </author>
            <date>2005</date>
        </biblioentry>

        <biblioentry xml:id="bib_z3986-2005-bkmk">
            <abbrev>Z39-86.2005-BOOKMARKS</abbrev>
            <title>
                <link xlink:href="http://www.daisy.org/z3986/2005/Z3986-2005.html#Bkmk">Portable
                    Bookmarks and Highlights</link> (part of <xref linkend="bib_z3986-2005"/>) </title>
            <author>
                <personname>M. Moodie, et al</personname>
            </author>
            <date>2005</date>
        </biblioentry>

        <biblioentry xml:id="bib_wav">
            <abbrev>RIFF WAVE</abbrev>
            <title>
                <link
                    xlink:href="http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/WAVE.html"
                    >RIFF WAVE PCM soundfile format <remark role="todo">TODO is there a canonical
                        spec for RIFF WAVE?</remark></link>
            </title>
        </biblioentry>

    </bibliography>
    
    <appendix xml:id="appendixWSDL" conformance="normative">
        <title>WSDL Abstract Definition</title>
        <para>The <xref linkend="bib_wsdl1.1"/> entities defined in the accompanying
            <link xlink:href="do-wsdl-10.wsdl">do-wsdl-10.wsdl</link> document constitute the abstract Web Service 
            contract that all compliant <xref linkend="term_service"/>s must adhere to.</para>

        <para>Service implementors must publish a concrete WSDL document at some URI.
            The <xref linkend="bib_infoset"/> of the concrete WSDL document must be identical to the 
            <link xlink:href="do-wsdl-10.wsdl">do-wsdl-10.wsdl</link> document and must include
            a custom WSDL <code>service</code> element to define the locally supported ports.</para>
        
        <para>The abstract <link xlink:href="do-wsdl-10.wsdl">do-wsdl-10.wsdl</link> document should be used
            as a template for creating the concrete document.</para>
    </appendix>

    <appendix xml:id="appendixDynamicMenuExamples" conformance="informative">
        <title>Dynamic Menu Usage Examples</title>
        <para>
            <remark role="todo">TODO this section is unfinished - extensive editing remains. This
                section will eventually be lifted out to become a standalone informative primer
                document.</remark>
        </para>
        <section xml:id="appendixDynamicMenuExamples_mainMenu">
            <title>Retrieving the Main Menu</title>
            <example>
                <title>Dynamic Menu example: Retrieving the Main Menu</title>
                <para>The Reading System retrieves the Main Menu of the Service by invoking the
                        <xref linkend="op_getQuestions"/> operation with the reserved id "default"
                    by passing in the following parameter:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-mainMenu-0.xml" parse="text"/></programlisting>
                </para>
                <para>The operation returns the following questions type, which conceptually
                    corresponds to the Service's "Main Menu":
                    <programlisting xml:id="appendixDynamicMenuExamples_mainMenuCode" xreflabel="Main Menu"><xi:include href="./samples/dynamicMenusExamples-mainMenu-1.xml" parse="text"/></programlisting>
                </para>
                <para role="tip"> Each userResponse element contains the user's response to a
                    particular question. As formally defined in <xref linkend="tp_userResponse"/>,
                    there are three reserved ids that have a special meaning: <itemizedlist>
                        <listitem>
                            <para><code>default</code> - returns the question that comprises the
                                Main Menu</para>
                        </listitem>
                        <listitem>
                            <para><code>search</code> - returns the question that comprises the
                                search menu</para>
                        </listitem>
                        <listitem>
                            <para><code>back</code> - returns the previous question.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para> A question can be a multiple choice question (see <xref
                        linkend="tp_multipleChoiceQuestion"/>), or a question that can receive a
                    numeric text, alphanumeric text or audio response from the user (see <xref
                        linkend="tp_inputQuestion"/>).</para>
                <para>If the <xref linkend="tp_userResponse"/> element is being used to encapsulate
                    the User's response to a multiple choice question, the <code>questionID</code>
                    attribute of the <type>userResponse</type> element contains the same value as
                    the <code>id</code> attribute of the corresponding
                        <type>multipleChoiceQuestion</type> element, and the <code>value</code>
                    attribute of the <type>userResponse</type> element contains the same value as
                    the <code>id</code> attribute of the <type>choice</type> element that the User
                    selected.</para>
                <para>If the <type>userResponse</type> element is being used to encapsulate the
                    User's response to a question that receives numeric text, alphanumeric text or
                    an audio response (i.e. an <xref linkend="tp_inputQuestion"/>), then the
                        <code>questionID</code> attribute of the <type>userResponse</type> element
                    contains the same value as the <code>id</code> attribute of the corresponding
                        <type>inputQuestion</type> element, and the <code>value</code> attribute of
                    the <type>userResponse</type> element contains: <itemizedlist>
                        <listitem>
                            <para>The numeric or alphanumeric text that the user entered if the
                                question receives a numeric or alphanumeric response.</para>
                        </listitem>
                        <listitem>
                            <para>An empty string or omitted altogether if the question receives an
                                audio response.</para>
                        </listitem>
                    </itemizedlist>
                </para>

                <para>If the question receives an audio response, the audio response is base 64
                    encoded and encapsulated in the data child element of the userResponse element.
                    See <xref linkend="tp_data"/> for file format requirements.</para>

                <para role="tip">The values assigned to the <code>id</code> attributes of the
                        <type>inputQuestion</type>, <type>multipleChoiceQuestion</type> and
                        <type>choice</type> elements in all the examples listed in this section are
                    arbitrary. These IDs are defined in <xref linkend="appendixWSDL"/> as the XSD ID
                    type (see <xref linkend="bib_xsdDatatypes"/>), and thus can take any unique
                    value.</para>

                <para>The Reading system renders this type to the user in the following way:
                    <literallayout>
What Would you like to do? 
 * Search the Library 
 * Update your profile 
 * Take a Survey. 
 * Buy a book 
 * Download or Stream content 
</literallayout></para>
            </example>
        </section>
        <section xml:id="appendixDynamicMenuExamples_search">
            <title>Performing Search</title>
            <example>
                <title>Dynamic Menu example: Performing a Search of the Service's Content
                    Collection</title>

                <para>As Search is envisaged to be a very important part of the Online Distribution
                    of content, and thus the Reading Systems may have specific user interface
                    components to invoke search, a special id is available and can be passed into
                    the <xref linkend="op_getQuestions"/> operation to retrieve the menu specific to
                    search.
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-search-1.xml" parse="text"/></programlisting>
                </para>

                <para role="tip">Using the <xref linkend="appendixDynamicMenuExamples_mainMenuCode"
                    /> from <xref linkend="appendixDynamicMenuExamples_mainMenu"/>, if the user
                    selects the "Search the Library" option, the following
                        <type>userResponses</type> type could also be used to retrieve the Search
                    menu:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-search-2.xml" parse="text"/></programlisting>
                </para>

                <para>The reserved <code>search</code> id thus, is a shortcut provided for those
                    Reading systems that have explicit user interface components for invoking the
                    Search feature.</para>

                <para>The operation returns the following questions type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-search-3.xml" parse="text"/></programlisting>
                    The Reading System renders this type to the user as follows:
                    <literallayout>
      What would you like to search by?
       * Title
       * Author
       * Genre
     </literallayout>
                </para>

                <para>Assuming that the user selects "Author," the reading system retrieves the next
                    menu by passing in the following parameter to the getQuestions operation:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-search-4.xml" parse="text"/></programlisting>
                </para>

                <para>This operation returns the following type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-search-5.xml" parse="text"/></programlisting>
                    The Reading System renders this type to the user as follows:
                    <literallayout>Please enter the name of the author.</literallayout>
                </para>

                <para>Assuming the user entered the name "J.K. Rowling," the Reading System invokes
                    the getQuestions operation with the following parameter:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-search-6.xml" parse="text"/></programlisting>
                    This operation returns the following questions type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-search-7.xml" parse="text"/></programlisting>
                    The reading system extracts the id of the contentList from the contentListRef
                    element, and invokes the getContentList operation as follows:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-search-8.xml" parse="text"/></programlisting>
                    thus requesting the contentList type with the id "l100," and specifying that the
                    first contentItem returned should be at index 0 and the last contentItem
                    returned should be at index 20 (i.e. the first 21 contentItem elements) in the
                    contentList type. The firstItem and lastItem parameters exist to enable the
                    reading system to request a contentList type with a specified number of
                    contentItem child elements, in situations where memory or bandwidth constraints
                    may not permit the retrieval of an entire contentList. </para>

                <para>The operation returns the following contentList type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-search-9.xml" parse="text"/></programlisting>
                    The Reading System renders this type as follows:
                    <literallayout>
Your Search for "J.K. Rawling" returned the following results: 
* harry potter and chamber of secrets
* harry potter and deathly hallows
* harry potter and goblet of fire
</literallayout>
                </para>
                <para>When a Service returns a contentListRef child element within a questions type,
                    the Reading system is logically at the end of the Service's dynamic menu. The
                    reading system extracts the id of the contentList from the contentListRef
                    element as illustrated above, and invokes the getContentList operation to
                    retrieve the contentList. </para>
                <para>The Reading System may then retrieve information about the specific
                    contentItems in the contentList type by invoking the getContentMetadata
                    operation, passing in the id of the particular content item. At this stage, the
                    Reading system may ask the user whether he/she wishes to Download or Stream
                    content. If the user wishes to download/stream content, the Reading system calls
                    the issueContent operation passing in the id of the particular content item,
                    followed by a call to the getContentResources operation, to request issuance and
                    retrieve the uris of the resources that constitute the particular content item
                    respectively. </para>
            </example>
        </section>
        <section xml:id="appendixDynamicMenuExamples_profileUpdate">
            <title>Updating the User Profile</title>
            <example>
                <title>Dynamic Menu example: Updating the User Profile</title>

                <para>Using the <xref linkend="appendixDynamicMenuExamples_mainMenuCode"/> from
                        <xref linkend="appendixDynamicMenuExamples_mainMenu"/>, if the user selects
                    the "Update your profile" option, the Reading System invokes the getQuestions
                    operation with the following parameter:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-userprofile-1.xml" parse="text"/></programlisting>
                    This operation returns the following type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-userprofile-2.xml" parse="text"/></programlisting>
                    The Reading system renders this type as follows:
                    <literallayout>
Your name:
Your Address: 
Your Gender
* Male
* Female
</literallayout>
                </para>
                <para>After the user responds to the questions, the Reading System invokes the
                    getQuestions operation passing in the following parameter:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-userprofile-3.xml" parse="text"/></programlisting>
                    This operation returns the following type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-userprofile-4.xml" parse="text"/></programlisting>
                    The Reading system renders this type to the user as follows:
                    <literallayout>
Your profile has been updated successfully!
</literallayout>
                </para>
                <para>As in the case of the Service returning a contentListRef child element within
                    a questions type, if the Service returns a label child element in the questions
                    type, the Reading System is logically at the end of the Service's dynamic
                    menu.</para>

                <para role="tip"> If the Service intends to take the user back to a previous menu
                    after a message such as "your profile has been updated successfully," the
                    Service returns a multipleChoiceQuestion element within the questions type as
                    follows:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-userprofile-5.xml" parse="text"/></programlisting>
                </para>
            </example>
        </section>
        <section xml:id="appendixDynamicMenuExamples_survey">
            <title>Taking a Survey (with audio responses)</title>
            <example>
                <title>Dynamic Menu example: Taking a Survey (with audio responses)</title>

                <para>Using the <xref linkend="appendixDynamicMenuExamples_mainMenuCode"/> from
                        <xref linkend="appendixDynamicMenuExamples_mainMenu"/>, if the user selects
                    the "Take a Survey" option, the Reading System invokes the getQuestions
                    operation passing in the following parameter:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-survey-1.xml" parse="text"/></programlisting>
                    This operation returns the following type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-survey-2.xml" parse="text"/></programlisting>
                    The Reading system renders this type as follows:
                    <literallayout>
What is your favorite feature in the Service?:

On a scale of one to four, where four is very satisfied and 1 is not satisfied, how would you rate the Service?
* 1
* 2
* 3
* 4

Please provide feedback on the Service.:
</literallayout>
                </para>

                <para>After the user responds to the questions, the Reading System invokes the
                    getQuestions operation passing in the following parameter:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-survey-3.xml" parse="text"/></programlisting>
                    This operation returns the following type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-survey-4.xml" parse="text"/></programlisting>
                    The Reading System renders this type as follows:
                    <literallayout>
Thank you for taking the Survey! What would you like to do next?
* Take another Survey.
* Go back to the previous menu. 
* Go back to the Main Menu
</literallayout></para>
            </example>
        </section>
        <section xml:id="appendixDynamicMenuExamples_purchase">
            <title>Content Purchase</title>
            <example>
                <title>Dynamic Menu example: Content purchase</title>

                <para>Using the <xref linkend="appendixDynamicMenuExamples_mainMenuCode"/> from
                        <xref linkend="appendixDynamicMenuExamples_mainMenu"/>, if the user selects
                    the "Buy a Book" option, the Reading System invokes the getQuestions operation
                    passing in the following parameter:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-purchase-1.xml" parse="text"/></programlisting>
                    This operation returns the following type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-purchase-2.xml" parse="text"/></programlisting>
                </para>
                <para role="tip">The allowMultipleSelections attribute of the multipleChoiceQuestion
                    element tells the Reading System whether a user should be allowed to select
                    multiple answers from the list of choices.</para>

                <para>When the User's answers are encapsulated in a userResponses type by the
                    Reading System for a multiple choice question that allows multiple selections,
                    each userResponse element holds information about a single selection. So if the
                    user selected three choices out of a list of five choices, the userResponses
                    type would contain three distinct userResponse child elements that hold
                    information about the three choices that the user selected. This is illustrated
                    in the userResponses type below. </para>

                <para>The Reading System renders this type as follows:
                    <literallayout>
Which of the following book(s) would you like to buy? 
* Harry Potter and the chamber of secrets
* Harry Potter and the deathly hallows
* Harry Potter and the goblet of fire
* Harry Potter and the half-blood Prince
* Harry Potter and the Order of the Phoenix
</literallayout>
                    (Assuming that the user selects choices 2, 3 and 5) </para>

                <para>The Reading system invokes the getQuestions operation passing in the following
                    parameter:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-purchase-3.xml" parse="text"/></programlisting>
                    This operation returns the following type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-purchase-4.xml" parse="text"/></programlisting>
                    The Reading system renders this type as follows:
                    <literallayout>
Thank you for purchasing "Harry Potter and the deathly hallows," "Harry Potter and the goblet of fire" and "Harry Potter and the Order of the Phoenix." These books have been billed to your credit card. What would you like to do next? 
* Buy more books
* Add these books to my download/streaming list
* Download/Stream these books now
</literallayout>
                </para>
                <para role="tip">This example presumes that a user's billing information is supplied
                    to the Service Provider through an out-of-band channel (i.e. website, phone
                    ...). However, extra steps could be added to this example to collect the user's
                    billing information if such out-of-band mechanisms were not an option. </para>

                <para role="tip">If the user selects "Download/Stream these books now, the Service
                    returns a contentListRef child element inside a questions type that contains the
                    id of a contentList, that can be retrieved through a call to the getContentList
                    operation, and that contains the three selected books. </para>

                <para>Assuming that the user selects "Add these books to my downloading/streaming
                    list, the Reading System invokes the getQuestions operation passing in the
                    following parameter:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-purchase-5.xml" parse="text"/></programlisting>
                    This operation returns the following type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-purchase-6.xml" parse="text"/></programlisting>
                    The Reading System renders this type as follows:
                    <literallayout>
Your books have been added to your downloading/streaming list. Please select the "Download or Stream content" option in the Main menu to download/stream these books.
</literallayout>
                </para>
            </example>
        </section>
        <section xml:id="appendixDynamicMenuExamples_retrieve">
            <title>Retrieving a Content list</title>
            <example>
                <title>Dynamic Menu example: Retrieving a Content list</title>

                <para>Using the <xref linkend="appendixDynamicMenuExamples_mainMenuCode"/> from
                        <xref linkend="appendixDynamicMenuExamples_mainMenu"/>, if the user selects
                    the "Download or Stream content" option, the Reading System invokes the
                    getQuestions operation passing in the following parameter:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-retrieve-1.xml" parse="text"/></programlisting>
                    This operation returns the following type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-retrieve-2.xml" parse="text"/></programlisting>
                    The reading system extracts the id of the contentList from the contentListRef
                    element, and invokes the getContentList operation as follows:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-retrieve-3.xml" parse="text"/></programlisting>
                    the operation returns the following contentList type:
                    <programlisting><xi:include href="./samples/dynamicMenusExamples-retrieve-4.xml" parse="text"/></programlisting>
                    The Reading System renders this type as follows:
                    <literallayout>
You have the following content waiting to be Downloaded/Streamed
* Harry Potter and the deathly hallows
* Harry Potter and the goblet of fire
* Harry Potter and the Order of the Phoenix
</literallayout>
                </para>
            </example>
        </section>
    </appendix>
    
    <appendix  xml:id="acknowledgements" role="acknowledgements">
        <title>Acknowledgments</title>
        <para>The following individuals were members of the DAISY Online Working Group at the time
            of the publication of this specification:</para>
        <para>
            <remark role="todo">TODO collect complete current member list</remark>
        </para>
        
        <itemizedlist>
            <listitem>
                <para>
                    <personname>
                        <firstname>Markus</firstname>
                        <surname>Gylling</surname>
                    </personname>,
                    <jobtitle>CTO</jobtitle>, <orgname>DAISY Consortium</orgname>
                    (co-chair) </para>
            </listitem>
            <listitem>
                <para>
                    <personname>
                        <firstname>Kenny</firstname>
                        <surname>Johar</surname>
                    </personname>,
                    <jobtitle>Enterprise Architect</jobtitle>, <orgname>Vision Australia</orgname>
                    (co-chair) </para>
            </listitem>
            <listitem>
                <para>
                    <personname>
                        <firstname>Hiro</firstname>
                        <surname>Fujimori</surname>
                    </personname>,
                    <jobtitle></jobtitle>, <orgname>Plextor</orgname>
                </para>
            </listitem>
            <listitem>
                <para>
                    <personname>
                        <firstname>Geoff</firstname>
                        <surname>Gilmour-Taylor</surname>
                    </personname>,
                    <jobtitle></jobtitle>, <orgname>CNIB</orgname>
                 </para>
            </listitem>
            <listitem>
                <para>
                    <personname>
                        <firstname>Jelle</firstname>
                        <surname>Martijn Kok</surname>
                    </personname>,
                    <jobtitle></jobtitle>, <orgname>Solutions Radio</orgname>
                </para>
            </listitem>
            <listitem>
                <para>
                    <personname>
                        <firstname>Simon</firstname>
                        <surname>Roy</surname>
                    </personname>,
                    <jobtitle></jobtitle>, <orgname>Humanware</orgname>
                </para>
            </listitem>
            <listitem>
                <para>
                    <personname>
                        <firstname>Nick</firstname>
                        <surname>Willliamson</surname>
                    </personname>,
                    <jobtitle></jobtitle>, <orgname>RNIB</orgname>
                </para>
            </listitem>
        </itemizedlist>
        
        <para>The editors also wish to thank the following individuals for their contribution,
            either as former members of the Working Group or as individual contributors:</para>
        <para>
            <remark role="todo">TODO collect complete former contributor list</remark>
        </para>
        
        <itemizedlist>
            <listitem>
                <para>
                    <personname>
                        <firstname>Clive</firstname>
                        <surname>Lansink</surname>
                    </personname>,
                    <jobtitle></jobtitle>, <orgname></orgname>
                </para>
            </listitem>
        </itemizedlist>
    </appendix>
 
</book>
